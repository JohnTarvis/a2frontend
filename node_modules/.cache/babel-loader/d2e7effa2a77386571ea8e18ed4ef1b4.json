{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/johnsaville/Desktop/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _regeneratorRuntime from\"/Users/johnsaville/Desktop/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/johnsaville/Desktop/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/johnsaville/Desktop/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{BrowserRouter}from\"react-router-dom\";import useLocalStorage from\"./hooks/useLocalStorage\";import Navigation from\"./routes-nav/Navigation\";import Routes from\"./routes-nav/Routes\";import LoadingSpinner from\"./common/LoadingSpinner\";import A2Api from\"./api/a2api\";import AnonContext from\"./auth/AnonContext\";import jwt from\"jsonwebtoken\";export var A2_TOKEN=\"anonanon-token\";function App(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),anon=_useState2[0],setAnon=_useState2[1];var _useLocalStorage=useLocalStorage(A2_TOKEN),_useLocalStorage2=_slicedToArray(_useLocalStorage,2),token=_useLocalStorage2[0],setToken=_useLocalStorage2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loaded=_useState4[0],setLoaded=_useState4[1];// const [posts, setPosts] = useState(null);\nuseEffect(function loadanonInfo(){function getAnon(){return _getAnon.apply(this,arguments);}function _getAnon(){_getAnon=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _jwt$decode,handle,_anon;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!token){_context.next=14;break;}_context.prev=1;_jwt$decode=jwt.decode(token),handle=_jwt$decode.handle;A2Api.token=token;_context.next=6;return A2Api.getAnon(handle);case 6:_anon=_context.sent;setAnon(_anon);_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);console.error(\"App loadanonInfo: problem loading\",_context.t0);setAnon(null);case 14:setLoaded(true);case 15:case\"end\":return _context.stop();}}},_callee,null,[[1,10]]);}));return _getAnon.apply(this,arguments);}setLoaded(false);getAnon();},[token]);function logout(){setAnon(null);setToken(null);}function register(_x){return _register.apply(this,arguments);}function _register(){_register=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(registerData){var _token;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return A2Api.register(registerData);case 3:_token=_context2.sent;setToken(_token);return _context2.abrupt(\"return\",{success:true});case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.error(\"register failed\",_context2.t0);return _context2.abrupt(\"return\",{success:false,errors:_context2.t0});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return _register.apply(this,arguments);}function createTags(_x2){return _createTags.apply(this,arguments);}function _createTags(){_createTags=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(tagString){var tags,_iterator,_step,tag;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:tags=tagString.split(/\\W+/);// console.log('IN APP listing tags: ',tags);\n_iterator=_createForOfIteratorHelper(tags);_context3.prev=2;_iterator.s();case 4:if((_step=_iterator.n()).done){_context3.next=17;break;}tag=_step.value;_context3.prev=6;_context3.next=9;return A2Api.createTag(tag);case 9:_context3.next=15;break;case 11:_context3.prev=11;_context3.t0=_context3[\"catch\"](6);console.log('failed to create tag: ',tag);console.log('errors ',_context3.t0);case 15:_context3.next=4;break;case 17:_context3.next=22;break;case 19:_context3.prev=19;_context3.t1=_context3[\"catch\"](2);_iterator.e(_context3.t1);case 22:_context3.prev=22;_iterator.f();return _context3.finish(22);case 25:case\"end\":return _context3.stop();}}},_callee3,null,[[2,19,22,25],[6,11]]);}));return _createTags.apply(this,arguments);}function createPost(_x3){return _createPost.apply(this,arguments);}function _createPost(){_createPost=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(postData){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;postData.poster_handle=anon.handle;_context4.next=4;return A2Api.createPost(postData);case 4:_context4.next=6;return createTags(postData.post_tags);case 6:return _context4.abrupt(\"return\",{success:true});case 9:_context4.prev=9;_context4.t0=_context4[\"catch\"](0);console.error(\"create post failed\",_context4.t0);return _context4.abrupt(\"return\",{success:false,errors:_context4.t0});case 13:case\"end\":return _context4.stop();}}},_callee4,null,[[0,9]]);}));return _createPost.apply(this,arguments);}function login(_x4){return _login.apply(this,arguments);}function _login(){_login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(loginData){var _token2;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:console.log('login');_context5.prev=1;_context5.next=4;return A2Api.login(loginData);case 4:_token2=_context5.sent;setToken(_token2);return _context5.abrupt(\"return\",{success:true});case 9:_context5.prev=9;_context5.t0=_context5[\"catch\"](1);console.error(\"login failed\",_context5.t0);return _context5.abrupt(\"return\",{success:false,errors:_context5.t0});case 13:case\"end\":return _context5.stop();}}},_callee5,null,[[1,9]]);}));return _login.apply(this,arguments);}if(!loaded)return/*#__PURE__*/React.createElement(LoadingSpinner,null);return/*#__PURE__*/React.createElement(BrowserRouter,null,/*#__PURE__*/React.createElement(AnonContext.Provider,{value:{anon:anon,setAnon:setAnon}},/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(Navigation,{logout:logout}),/*#__PURE__*/React.createElement(Routes,{login:login,register:register,createPost:createPost}))));}export default App;","map":{"version":3,"sources":["/Users/johnsaville/Desktop/frontend/src/App.js"],"names":["React","useState","useEffect","BrowserRouter","useLocalStorage","Navigation","Routes","LoadingSpinner","A2Api","AnonContext","jwt","A2_TOKEN","App","anon","setAnon","token","setToken","loaded","setLoaded","loadanonInfo","getAnon","decode","handle","console","error","logout","register","registerData","success","errors","createTags","tagString","tags","split","tag","createTag","log","createPost","postData","poster_handle","post_tags","login","loginData"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { BrowserRouter } from \"react-router-dom\";\nimport useLocalStorage from \"./hooks/useLocalStorage\";\nimport Navigation from \"./routes-nav/Navigation\";\nimport Routes from \"./routes-nav/Routes\";\nimport LoadingSpinner from \"./common/LoadingSpinner\";\nimport A2Api from \"./api/a2api\";\nimport AnonContext from \"./auth/AnonContext\";\nimport jwt from \"jsonwebtoken\";\n\nexport const A2_TOKEN = \"anonanon-token\";\n\nfunction App() {\n  \n  const [anon, setAnon] = useState(null);\n  const [token, setToken] = useLocalStorage(A2_TOKEN);\n  const [loaded, setLoaded] = useState(false);\n  // const [posts, setPosts] = useState(null);\n\n  useEffect(function loadanonInfo() {\n\n    async function getAnon() {\n      if (token) {\n        try {\n          let { handle } = jwt.decode(token);\n          A2Api.token = token;\n          let anon = await A2Api.getAnon(handle);\n          setAnon(anon);\n        } catch (err) {\n          console.error(\"App loadanonInfo: problem loading\", err);\n          setAnon(null);\n        }\n      }\n      setLoaded(true);\n    }\n    setLoaded(false);\n    getAnon();\n  }, [token]);\n\n  function logout() {\n    setAnon(null);\n    setToken(null);\n  }\n\n  async function register(registerData) {\n    try {\n      let token = await A2Api.register(registerData);\n      setToken(token);\n      return { success: true };\n    } catch (errors) {\n      console.error(\"register failed\", errors);\n      return { success: false, errors };\n    }\n  }\n\n  async function createTags(tagString){\n    const tags = tagString.split(/\\W+/);\n    // console.log('IN APP listing tags: ',tags);\n    for(let tag of tags){\n      // console.log('IN APP going through tags loop current is:',tag);\n      try{\n        await A2Api.createTag(tag);\n        // console.log('successfully added tag: ',tag);\n      } catch(errors){\n        console.log('failed to create tag: ',tag);\n        console.log('errors ',errors);\n      }\n    } \n  }\n\n  async function createPost(postData){\n    try {\n      postData.poster_handle = anon.handle;\n      await A2Api.createPost(postData);\n      await createTags(postData.post_tags);\n      return { success: true };\n    } catch (errors) {\n      console.error(\"create post failed\", errors);\n      return { success: false, errors };\n    }\n  }\n\n  async function login(loginData) {\n    console.log('login');\n    try {\n      let token = await A2Api.login(loginData);\n      setToken(token);\n      return { success: true };\n    } catch (errors) {\n      console.error(\"login failed\", errors);\n      return { success: false, errors };\n    }\n  }\n\n  if (!loaded) return <LoadingSpinner />;\n\n  return (\n      <BrowserRouter>\n        <AnonContext.Provider value={{ anon, setAnon}}>\n          <div className=\"App\">\n            <Navigation logout={logout} />\n            <Routes login={login} \n                    register={register} \n                    createPost={createPost} />\n          </div>\n        </AnonContext.Provider>\n      </BrowserRouter>\n  );\n}\n\nexport default App;\n\n\n"]},"metadata":{},"sourceType":"module"}